<!DOCTYPE html><html><head><title>Covid-19 - Supermarket Waiting Times</title><meta name="author" content="https://github.com/TheJoin95/covid19-market-waiting-times/"><link rel="icon" type="image/png" href="/assets/icon-resize.png"><meta name="description" content="A project to help people stand in line at the market as little as possible"><meta charset="utf-8"><link rel="manifest" href="manifest.json"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta property="og:title" content="Covid-19 - Supermarket Waiting Times"><meta property="og:image" content="https://covid19-waiting-time.thejoin.tech/assets/map.png"><meta property="og:description" content="A project to help people stand in line at the market as little as possible"><meta property="og:url" content="https://covid19-waiting-time.thejoin.tech"><script data-ad-client="ca-pub-9563589123138123" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""><script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script><style>html{font-family:Raleway,sans-serif}body{margin:0}#full-map{width:100%;height:200px}.info{padding:6px 8px;font-size:14px;background:rgba(255,255,255,.8);box-shadow:0 0 15px rgba(0,0,0,.2);border-radius:5px}.info h4{margin:0 0 5px;color:#777}.legend{text-align:left;line-height:18px;color:#555}.legend i{width:16px;height:16px;float:left;margin-right:8px;opacity:.7}div#loading{position:absolute;top:0;left:0;height:100%;width:100%;z-index:1000;background:#9e9e9e61}div#loading span{text-align:center;position:relative;top:50%;left:50%;width:160px;display:block;margin-top:0;color:#333;margin-left:-80px}.sk-chase{width:40px;height:40px;position:relative;top:50%;left:50%;width:40px;margin-top:-20px;margin-left:-20px;animation:sk-chase 2.5s infinite linear both}.sk-chase-dot{width:100%;height:100%;position:absolute;left:0;top:0;animation:sk-chase-dot 2s infinite ease-in-out both}.sk-chase-dot:before{content:'';display:block;width:25%;height:25%;background-color:#fff;border-radius:100%;animation:sk-chase-dot-before 2s infinite ease-in-out both}.sk-chase-dot:nth-child(1){animation-delay:-1.1s}.sk-chase-dot:nth-child(2){animation-delay:-1s}.sk-chase-dot:nth-child(3){animation-delay:-.9s}.sk-chase-dot:nth-child(4){animation-delay:-.8s}.sk-chase-dot:nth-child(5){animation-delay:-.7s}.sk-chase-dot:nth-child(6){animation-delay:-.6s}.sk-chase-dot:nth-child(1):before{animation-delay:-1.1s}.sk-chase-dot:nth-child(2):before{animation-delay:-1s}.sk-chase-dot:nth-child(3):before{animation-delay:-.9s}.sk-chase-dot:nth-child(4):before{animation-delay:-.8s}.sk-chase-dot:nth-child(5):before{animation-delay:-.7s}.sk-chase-dot:nth-child(6):before{animation-delay:-.6s}@keyframes sk-chase{100%{transform:rotate(360deg)}}@keyframes sk-chase-dot{100%,80%{transform:rotate(360deg)}}@keyframes sk-chase-dot-before{50%{transform:scale(.4)}0%,100%{transform:scale(1)}}@keyframes opac{from{opacity:0}to{opacity:1}}.modal{z-index:100000;display:none;padding-top:100px;position:fixed;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:#000;background-color:rgba(0,0,0,.4)}.animate-opacity{animation:opac .8s}.card-4{box-shadow:0 4px 10px 0 rgba(0,0,0,.2),0 4px 20px 0 rgba(0,0,0,.19)}.modal-content{margin:auto;background-color:#fff;position:relative;padding:0;outline:0;width:600px;max-width:100%}.modal-content textarea{width:100%;margin-top:10px;padding:5px;border:1px solid #f2f2f2;resize:none}.teal{color:#fff!important;background-color:#009688!important}.container,.panel{padding:.01em 16px}.display-topright{position:absolute;right:0;top:0}.close-button{border:none;font-size:2.4em;display:inline-block;padding:8px 16px;vertical-align:middle;overflow:hidden;text-decoration:none;color:inherit;background-color:inherit;text-align:center;cursor:pointer;white-space:nowrap}.modal-content .btn{padding:10px 10px;background:#028276;margin:10px;display:inline-block;cursor:pointer;border-radius:5px}.progress{position:absolute;height:4px;z-index:10000;display:none;width:100%;background-color:#2780ca;border-radius:2px;background-clip:padding-box;margin:0 0 1rem 0;overflow:hidden}.progress .indeterminate{background-color:#26a69a}.progress .indeterminate:before{content:'';position:absolute;background-color:inherit;top:0;left:0;bottom:0;will-change:left,right;-webkit-animation:indeterminate 2.1s cubic-bezier(.65,.815,.735,.395) infinite;animation:indeterminate 2.1s cubic-bezier(.65,.815,.735,.395) infinite}.progress .indeterminate:after{content:'';position:absolute;background-color:inherit;top:0;left:0;bottom:0;will-change:left,right;-webkit-animation:indeterminate-short 2.1s cubic-bezier(.165,.84,.44,1) infinite;animation:indeterminate-short 2.1s cubic-bezier(.165,.84,.44,1) infinite;-webkit-animation-delay:1.15s;animation-delay:1.15s}@-webkit-keyframes indeterminate{0%{left:-35%;right:100%}60%{left:100%;right:-90%}100%{left:100%;right:-90%}}@keyframes indeterminate{0%{left:-35%;right:100%}60%{left:100%;right:-90%}100%{left:100%;right:-90%}}@-webkit-keyframes indeterminate-short{0%{left:-200%;right:100%}60%{left:107%;right:-8%}100%{left:107%;right:-8%}}@keyframes indeterminate-short{0%{left:-200%;right:100%}60%{left:107%;right:-8%}100%{left:107%;right:-8%}}.rate{border-radius:8px;font-size:20px;padding:8px}input[type=radio]{box-shadow:none}.rate{height:auto;display:inline-flex;flex-direction:row-reverse;align-items:center;justify-content:center;width:100%;margin:auto}.rate:not(:checked)>input{position:relative;margin-left:-29px;top:15px;left:-5px;width:19px;padding-right:0;z-index:-10}.rate:not(:checked)>label{float:right;width:1em;overflow:hidden;white-space:nowrap;cursor:pointer;font-size:3rem;color:#ccc;height:3rem}.rate:not(:checked)>label::before{content:'‚òÖ ';position:relative;top:-15px;left:2px}.rate>input:checked~label{color:#ffc700}.rate>input:checked:focus+label,.rate>input:focus+label{outline:-webkit-focus-ring-color auto 5px}.rate:not(:checked)>label:hover,.rate:not(:checked)>label:hover~label{color:#deb217}.rate>input:checked+label:hover,.rate>input:checked+label:hover~label,.rate>input:checked~label:hover,.rate>input:checked~label:hover~label,.rate>label:hover~input:checked~label{color:#c59b08}div#help-button{position:fixed;top:10px;right:10px;z-index:10000;border-radius:50%;text-align:center;background:#ffc950;font-size:1.2em;padding:1em;border:1px solid #fcd25e;cursor:pointer;width:26px;height:26px}div#search-button{position:fixed;bottom:10px;text-center:center;right:10px;z-index:10000;border-radius:50%;background:#2780ca;font-size:1.2em;padding:1em;border:1px solid #35a9ff;cursor:pointer;width:26px;height:26px}input[type=text]{width:100%;padding:12px 20px;margin:8px 0;display:inline-block;border:1px solid #ccc;border-radius:4px;outline:0;box-sizing:border-box}#banner{position:absolute;bottom:0;width:100%;z-index:10000;background:#26a69a;text-align:center;color:#f2f2f2;padding:5px 0}@media only screen and (max-width:640px){div#help-button,div#search-button{padding:.5em}}</style></head><body><div class="progress" id="top-progress-bar"><div class="indeterminate"></div></div><div id="help-button" onclick="TimesApp.showModalHelp();"><span>‚ùì</span></div><div id="search-button" onclick="TimesApp.search();"><span>üîç</span></div><div id="loading" style="display: none"><div class="sk-chase"><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div></div><span>loading geodata</span></div><div id="full-map"></div><footer><center><small>Waiting times are estimated</small></center><center>Made with ‚ù§ in Florence | <a href="https://github.com/TheJoin95/covid19-market-waiting-times" target="_blank">&#x1f517; Open Source on Github</a></center></footer><div id="banner">Due to the high traffic volume, the map may be slow and may not show some places. The project is open source, if anyone wants to help, they can write <a href="https://github.com/TheJoin95/covid19-market-waiting-times/issues" target="_blank">here</a>. Thank you.</div><script>/*! covid19-market-waiting-times 2020-04-12 */

const API_DOMAIN_AVAILABLE=["api-geo","api-geo-uk"],API_DOMAIN=API_DOMAIN_AVAILABLE[Math.floor(Math.random()*API_DOMAIN_AVAILABLE.length)],WaitingTimesAPI={fallbackGeocodeAPI:"https://nominatim.openstreetmap.org/search.php?q=%s&format=json",geocodeAPI:"https://"+API_DOMAIN+".thejoin.tech/geocode?lat=%s&lng=%s",geocodeAPIClient:"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/reverseGeocode?f=pjson&featureTypes=&location=%s,%s",logAPI:"https://api-geo.thejoin.tech/logger",getPlaceByNameAPI:"https://api-geo.thejoin.tech/places/get-by-name?q=%s&address=%s",getPlacesAPI:"https://api-geo-fr.thejoin.tech/places/explore?q=%s&address=%s",getPlacesAPIFallback:"https://api-geo-fr.thejoin.tech/places/explore-redis?q=%s&address=%s",searchSuggestAPI:"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/suggest?text=%s&maxSuggestions=10&category=city,address&countryCode=&searchExtent=&location=&distance=&f=json",format:function(e){var t=[].slice.call(arguments,1),a=0;return e.replace(/%s/g,()=>t[a++])}};Number.prototype.toRad=function(){return this*Math.PI/180},Number.prototype.toDeg=function(){return 180*this/Math.PI};const Utils={updateTimeout:null,geoErrorTimeout:null,geoErrorFailOverCount:0,sendError:function(e){e.ua=navigator.userAgent,e.date=(new Date).toString(),fetch(WaitingTimesAPI.logAPI,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)})},searchSuggest:async function(e){if(e.value.length>3){var t=WaitingTimesAPI.format(WaitingTimesAPI.searchSuggestAPI,e.value),a=await fetch(t);if(a.ok){var s=await a.json(),i=[];if(s.suggestions.length>0)for(let e in s.suggestions)i.push(s.suggestions[e].text)}}},setDefaultLocation:function(e,t,a){var s={address:e,latt:t,longt:a};localStorage.setItem("defaultLocation",JSON.stringify(s))},getDefaultLocation:function(){return JSON.parse(localStorage.getItem("defaultLocation"))},searchByNameModal:function(){document.body.removeChild(document.querySelector(".modal")),Utils.openModal("search-modal","Search by name and address",'<input type="text" placeholder="Insert market or place name" id="place"><input type="text" placeholder="Insert address or city" id="address">',"Search",function(){TimesApp.getPlace(document.getElementById("place").value,document.getElementById("address").value),document.body.removeChild(document.querySelector(".modal"))})},openModal:function(e,t,a,s,i,n){e=e||(new Date).getTime();var o=t,r=(s=s||"Send",document.createElement("div"));r.id=e,r.className="modal";var p=document.createElement("div");p.className="modal-content animate-opacity card-4",r.appendChild(p);var l=document.createElement("header");l.className="container teal",p.appendChild(l);var d=document.createElement("div");d.className="container",p.appendChild(d),d.innerHTML=a||'<p>Did not find what you were looking for? <br/><u style="cursor: pointer" onclick="Utils.searchByNameModal()">Tap here to search by name üîç</u></p><input type="text" id="email" placeholder="Insert an email for an answer or leave blank" /><textarea placeholder="Write here your question or tips" rows="7"></textarea><small><i>Note: this is not a search box</i></small>';var c=document.createElement("span");c.className="close-button display-topright",c.setAttribute("onclick","document.getElementById('"+e+"').style.display='none'"),c.innerHTML="&times;",l.appendChild(c);var m=document.createElement("H2");m.innerHTML=o,l.appendChild(m);var u=document.createElement("footer");u.className="container teal",p.appendChild(u);var g=document.createElement("span");if(g.className="btn",-1!==s&&(g.style.float="right"),void 0===n?g.setAttribute("onclick","document.getElementById('"+e+"').style.display='none'"):g.addEventListener("click",n),g.innerHTML="Close",u.appendChild(g),-1!==s){var A=document.createElement("span");A.className="btn",void 0===i?A.setAttribute("onclick","TimesApp.sendHelp(document.querySelector('.modal-content textarea').value, document.querySelector('.modal-content #email').value)"):A.addEventListener("click",i),A.innerHTML=s,u.appendChild(A)}r.style.display="block",document.getElementsByTagName("body")[0].appendChild(r)},getAccurateCurrentPosition:function(e,t,a,s){var i,n,o,r=0,p=function(t){e(t)};(s=s||{}).maxWait||(s.maxWait=1e4),s.desiredAccuracy||(s.desiredAccuracy=20),s.timeout||(s.timeout=s.maxWait),s.maximumAge=0,s.enableHighAccuracy=!0,n=navigator.geolocation.watchPosition(function(e){i=e,r+=1,e.coords.accuracy<=s.desiredAccuracy&&r>1?(clearTimeout(o),navigator.geolocation.clearWatch(n),p(e)):a(e)},function(e){clearTimeout(o),navigator.geolocation.clearWatch(n),t(e)},s),o=setTimeout(function(){navigator.geolocation.clearWatch(n),p(i)},s.maxWait)},destinationPoint:function(e,t,a,s){s/=6371,a=a.toRad();var i=e.toRad(),n=t.toRad(),o=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),r=n+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(o));return isNaN(o)||isNaN(r)?null:[o.toDeg(),r.toDeg()]},distanceLatLng:function(e,t,a,s){var i=(a-e).toRad(),n=(s-t).toRad(),o=(e=e.toRad(),a=a.toRad(),Math.sin(i/2)*Math.sin(i/2)+Math.sin(n/2)*Math.sin(n/2)*Math.cos(e)*Math.cos(a));return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))}},TimesApp={lat:null,lng:null,address:"",zoom:15,lMap:null,myPosition:null,query:"supermarket",isLoading:!1,place_ids:[],icons:[],fullEstimation:!0,setLoading:function(e){TimesApp.isLoading=e;var t=!0===e?"block":"none";document.getElementById("top-progress-bar").style.display=t},initIcon:function(){const e=["0","1","2","3","4","5","6","7","8"];for(const t in e)TimesApp.icons.push(L.icon({iconUrl:"/assets/custom-marker/"+e[t]+".png",iconSize:[42,42],iconAnchor:[20,32],popupAnchor:[2,-20]}))},initMap:function(){TimesApp.toggleSpinner(),TimesApp.initIcon(),TimesApp.lMap=L.map("full-map").setView([TimesApp.lat,TimesApp.lng],TimesApp.zoom),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18,minZoom:14,attribution:'Map data <a href="https://openstreetmap.org">OpenStreetMap</a> contributors'}).addTo(TimesApp.lMap),TimesApp.lMap.zoomControl.remove(),TimesApp.myPosition=L.circle([TimesApp.lat,TimesApp.lng],{color:"#0696c1",fillColor:"#06aee0",fillOpacity:.5,radius:50}).bindPopup("Your position").addTo(TimesApp.lMap),TimesApp.lMap.on("moveend",async function(){clearTimeout(Utils.updateTimeout);let e=TimesApp.lMap.getCenter();console.log("new center ",e.toString()),Utils.distanceLatLng(TimesApp.lat,TimesApp.lng,e.lat,e.lng)>=3&&(TimesApp.lat=parseFloat(e.lat),TimesApp.lng=parseFloat(e.lng),Utils.updateTimeout=setTimeout(async function(){await TimesApp.updateAddress(-1),await TimesApp.updateBound(TimesApp.lat,TimesApp.lng),TimesApp.getPharmacies()},1e3))}),TimesApp.showLegend(),TimesApp.getPlaces(null,!0)},getMarkerPlaceColor:function(e){return e>60?[6,"#cc0c33"]:e>45?[5,"#ff2929"]:e>30?[4,"#fa4c25"]:e>25?[3,"#fc7e2a"]:e>15?[2,"#ffbf1c"]:e>10?[1,"#ecf716"]:[0,"#1fcc00"]},showLegend:function(){var e=L.control({position:"bottomright"});e.onAdd=function(e){for(var t,a,s=L.DomUtil.create("div","info legend"),i=[5,10,15,25,30,45,60],n=[],o=0;o<i.length;o++)t=i[o],a=i[o+1],n.push('<i style="background:'+TimesApp.getMarkerPlaceColor(i[o]+1)[1]+'"></i> '+t+(a?"&ndash;"+a:"+"));return s.innerHTML="Minutes:<br>"+n.join("<br>"),s},e.addTo(TimesApp.lMap)},getWaitTime:function(e){const t=(new Date).getHours(),a=0===(new Date).getDay()?6:(new Date).getDay()-1;var s=meanTimeSpent=minTimeSpent=0;void 0!==e.time_spent&&e.time_spent.length>0&&(e.time_spent[0]=1==e.time_spent[0]?60:e.time_spent[0],e.time_spent[1]=1==e.time_spent[1]?60:e.time_spent[1],s=Math.max(...e.time_spent),minTimeSpent=Math.min(...e.time_spent),meanTimeSpent=e.time_spent.reduce(function(e,t){return e+t},0)/2);const i=e.current_popularity||0;var n=popTimes=0;void 0!==e.time_wait&&e.time_wait.length>0&&(n=e.time_wait[a].data[t]),popTimes=e.populartimes[a].data[t];var o=0;const r=popTimes-i;var p=popTimes>0?meanTimeSpent:0;0!==i&&n>0?popTimes/i<=2.95?r<=0?p=s+5*Math.ceil(i/2/5):r>0&&r<popTimes/5?p=meanTimeSpent:r>=popTimes/5&&r<=popTimes/2.9?p=minTimeSpent:r>popTimes/2.9&&(p=0,n=5*Math.ceil(20*n/100/5)):i>=popTimes/2.9?p=minTimeSpent:(n=0,p=5):0==n?p=0:0==i&&0==TimesApp.fullEstimation&&(l=0,p=0),o+=p;var l=Math.ceil(n+o);return 0!==popTimes&&i>=18&&(l+=5),0!==l||0!==meanTimeSpent&&0!==i||(l="No information about "),[e.populartimes[a].data[t],l]},getPharmacies:function(){console.log("Getting pharmacy"),TimesApp.getPlaces("pharmacy")},getPlace:function(e,t){TimesApp.setLoading(!0);const a=WaitingTimesAPI.format(WaitingTimesAPI.getPlaceByNameAPI,e,t);ga("send","event","Request","Place",e+" "+t),fetch(a).then(e=>{if(e.ok)return e.json()}).then(t=>{const a=TimesApp.setPlaceOnMap(t);a.length>0?a[a.length-1].openPopup():void 0!==t[0].populartimes&&null!==t[0].populartimes?TimesApp.lMap.setView([t[0].coordinates.lat,t[0].coordinates.lng],TimesApp.zoom):alert("Unfortunally "+e+" does not have any information about waiting times")}).catch(e=>Utils.sendError({url:a,singlePlace:!0,message:e.toString()}))},getPlacesFallback:async function(){const e=WaitingTimesAPI.format(WaitingTimesAPI.getPlacesAPI.replace("api-geo-fr","api-geo"),TimesApp.query,TimesApp.address);ga("send","event","Request","Places",TimesApp.address),fetch(e).then(e=>{if(e.ok)return e.json()}).then(e=>TimesApp.setPlaceOnMap(e)).catch(t=>Utils.sendError({url:e,message:t.toString()}))},getPlaces:function(e,t){e=e||TimesApp.query,t=t||!1;if(TimesApp.setLoading(!0),10==Math.floor(16*Math.random())||t){var a=new Headers;a.append("x-geo-lat",TimesApp.lat),a.append("x-geo-lng",TimesApp.lng);const t=WaitingTimesAPI.format(WaitingTimesAPI.getPlacesAPIFallback,e,TimesApp.address);ga("send","event","Request","Places",TimesApp.address),fetch(t,{headers:a}).then(e=>{if(e.ok)return e.json()}).then(e=>TimesApp.setPlaceOnMap(e)).catch(e=>TimesApp.getPlacesFallback())}else{var s=WaitingTimesAPI.getPlacesAPI;10==Math.floor(16*Math.random())&&(s=s.replace("api-geo-fr","api-geo-uk"));const t=WaitingTimesAPI.format(s,e,TimesApp.address);ga("send","event","Request","Places",TimesApp.address),fetch(t).then(e=>{if(e.ok)return e.json()}).then(e=>TimesApp.setPlaceOnMap(e)).catch(e=>TimesApp.getPlacesFallback())}},setPlaceOnMap:function(e){console.log(e),TimesApp.setLoading(!1);var t=[];for(const s in e){if(void 0===e[s].populartimes||-1!==TimesApp.place_ids.indexOf(e[s].place_id))continue;let i=TimesApp.getWaitTime(e[s]),n=i[1],o=TimesApp.getMarkerPlaceColor(n),r="<b>"+e[s].name+"</b><br><small>"+e[s].address+"</small><br/><i>"+n+"min</i> of line";0===i[0]&&(o=["7","#777"],r="<i>Closed</i><br/>"+r);var a="string"==typeof n&&"7"!=o[0]?TimesApp.icons[8]:TimesApp.icons[o[0]];const p=L.marker([e[s].coordinates.lat,e[s].coordinates.lng],{icon:a});p.bindPopup(r),p.addTo(TimesApp.lMap),t.push(p),TimesApp.place_ids.push(e[s].place_id)}return t},updateAddressAwait:async function(e){e=e||!0;var t=await fetch(WaitingTimesAPI.format(WaitingTimesAPI.geocodeAPI,TimesApp.lat,TimesApp.lng));(t=t.ok?await t.json():{staddress:"",city:""}).staddress="object"==typeof t.staddress||void 0===t.staddress?"":t.staddress,t.city="object"==typeof t.city||void 0===t.city?"":t.city,TimesApp.address=""!==t.staddress?t.staddress+", ":"",TimesApp.address+=t.city,!0===e?TimesApp.initMap():TimesApp.getPlaces(),ga("send","event","Request","Geocode",WaitingTimesAPI.geocodeAPI)},updateAddress:async function(e){e=e||!0,TimesApp.setLoading(!0);var t=[WaitingTimesAPI.format(WaitingTimesAPI.geocodeAPI,TimesApp.lat,TimesApp.lng),WaitingTimesAPI.format(WaitingTimesAPI.geocodeAPIClient,TimesApp.lng,TimesApp.lat),WaitingTimesAPI.format(WaitingTimesAPI.geocodeAPIClient,TimesApp.lng,TimesApp.lat),WaitingTimesAPI.format(WaitingTimesAPI.geocodeAPIClient,TimesApp.lng,TimesApp.lat),WaitingTimesAPI.format(WaitingTimesAPI.geocodeAPIClient,TimesApp.lng,TimesApp.lat)],a=Math.floor(Math.random()*t.length);const s=t[a];var i=await fetch(s),n={staddress:"",city:""};if(!i.ok){let e=await i.json();return Utils.sendError({url:s,updateAddress:!0,message:e.toString()}),!1}(n=await i.json()).staddress="object"==typeof n.staddress||void 0===n.staddress?"":n.staddress,n.city="object"==typeof n.city||void 0===n.city?"":n.city,""===n.staddress&&void 0!==n.address&&(n.staddress=void 0===n.address.Address?"":n.address.Address),""===n.city&&void 0!==n.address&&(n.city=void 0===n.address.City?"":n.address.City),TimesApp.address=""!==n.staddress?n.staddress+", ":"",TimesApp.address+=n.city,!0===e?TimesApp.initMap():TimesApp.getPlaces(),ga("send","event","Request","Geocode",0==a?WaitingTimesAPI.geocodeAPI:WaitingTimesAPI.geocodeAPIClient)},updateBound:async function(e,t){TimesApp.setLoading(!0);for(var a=0;a<=360;a+=120){let s=Utils.destinationPoint(e,t,a,2.5);TimesApp.lat=parseFloat(s[0]),TimesApp.lng=parseFloat(s[1]),await new Promise(e=>setTimeout(e,3e3)),await TimesApp.updateAddress(-1)}},geoSuccess:async function(e){if(void 0===e)return TimesApp.geoError(),!1;TimesApp.lat=parseFloat(e.coords.latitude),TimesApp.lng=parseFloat(e.coords.longitude),await TimesApp.updateAddressAwait(),await TimesApp.updateBound(TimesApp.lat,TimesApp.lng),ga("send","event","Geolocation","GeoSuccess","true")},showModalHelp:function(){null!==document.querySelector(".modal")&&document.body.removeChild(document.querySelector(".modal")),Utils.openModal("help-modal","Need help? Do you want to ask something?")},sendReview:function(e){e=e||"0";ga("send","event","Review","Rate",e),Utils.sendError({rate:e}),localStorage.setItem("sended_review","yes"),document.querySelector(".modal-content div.container").innerHTML="<h2>Feedback sent, thank you!</h2>",setTimeout(function(){document.body.removeChild(document.getElementById("rating-modal"))},1200)},sendHelp:function(e,t){t=t||"";Utils.sendError({message:e,email:t,help:!0}),document.querySelector(".modal-content div.container").innerHTML="<h2>Message sent, thank you!</h2>",setTimeout(function(){document.getElementById("help-modal").style.display="none"},1200)},fallbackGeocodeCall:async function(e){var t=await fetch(WaitingTimesAPI.format(WaitingTimesAPI.fallbackGeocodeAPI,e)),a=await t.json();return a.length>0&&void 0!==a[0].lat?(a.latt=a[0].lat,a.longt=a[0].lon):a.error=!0,a},search:async function(){if(TimesApp.address=prompt("This app need your gps position or at least your address or your city:",""),TimesApp.setLoading(!0),null===TimesApp.address)return!1;if(""!=TimesApp.address){ga("send","event","Request","Search",TimesApp.address);const a="https://geocode.xyz/"+TimesApp.address+"?json=1";var e=await fetch(a),t=await e.json();if((!e.ok||void 0!==t.error&&"006"===t.error.code)&&(t=await TimesApp.fallbackGeocodeCall(TimesApp.address)),void 0!==t.error)return setTimeout(function(){alert("No results. Check your address/city and try again. Please write the city in english"),Utils.sendError({url:a,search:!0,message:t.error}),TimesApp.search()},2e3),!1;TimesApp.lat=parseFloat(t.latt),TimesApp.lng=parseFloat(t.longt),TimesApp.getPlaces(null,!0),TimesApp.lMap.setView([TimesApp.lat,TimesApp.lng],TimesApp.zoom),TimesApp.updateBound(TimesApp.lat,TimesApp.lng)}},promptAddress:function(){return prompt("This app need your gps position or at least your address or your city:","")},geoError:async function(e){if(clearTimeout(Utils.geoErrorTimeout),TimesApp.address=TimesApp.promptAddress(),null===TimesApp.address?(Utils.geoErrorFailOverCount+=1,TimesApp.lat=43.7740236,TimesApp.lng=11.253233,TimesApp.address="Firenze",null===TimesApp.lMap&&TimesApp.initMap(),Utils.geoErrorFailOverCount<2&&(Utils.geoErrorTimeout=setTimeout(function(){TimesApp.geoError()},1e3))):TimesApp.address=TimesApp.address.trim(),""!=TimesApp.address){ga("send","event","Geolocation","GeoError",TimesApp.address);const e="https://geocode.xyz/"+TimesApp.address+"?json=1";var t=await fetch(e),a=await t.json();if((!t.ok||void 0!==a.error&&"006"===a.error.code)&&(a=await TimesApp.fallbackGeocodeCall(TimesApp.address)),void 0!==a.error)return setTimeout(function(){alert("No results. Check your address/city and try again. Please write the city in english"),Utils.sendError({url:e,geoError:!0,message:a.error}),TimesApp.search()},2e3),!1;TimesApp.lat=parseFloat(a.latt),TimesApp.lng=parseFloat(a.longt),null===TimesApp.lMap?(TimesApp.initMap(),TimesApp.updateBound(TimesApp.lat,TimesApp.lng)):(TimesApp.getPlaces(null,!1),TimesApp.updateBound(TimesApp.lat,TimesApp.lng))}},toggleSpinner:function(){const e=document.getElementById("loading");let t="block";"block"==e.style.display&&(t="none"),e.style.display=t}};window.onerror=function(e,t,a){const s={date:(new Date).toString(),ua:navigator.userAgent,errorMessage:e,errorUrl:t,errorLine:a};Utils.sendError(s)},document.addEventListener("DOMContentLoaded",function(){document.getElementById("full-map").style.height=window.innerHeight-50+"px",TimesApp.toggleSpinner(),Utils.getAccurateCurrentPosition(TimesApp.geoSuccess,TimesApp.geoError,function(e){console.log(e)},{desiredAccuracy:100,maxWait:8e3}),setTimeout(function(){document.getElementById("banner").style.display="none"},4e4),"yes"!==localStorage.getItem("sended_review")&&setTimeout(function(){Utils.openModal("rating-modal","Please, take time to rate this project",'\n                                            <h4>Your feedback is very important to understand if the estimates are correct or not. Together we can build something useful!</h4>\n                                            <div class="rate">\n                                              <input type="radio" id="star5" name="rate" value="5">\n                                              <label onclick="TimesApp.sendReview(this.getAttribute(\'data-value\'))" for="star5" data-value="5" title="5 stars">5 stars</label>\n                                              <input type="radio" id="star4" name="rate" value="4">\n                                              <label onclick="TimesApp.sendReview(this.getAttribute(\'data-value\'))" for="star4" data-value="4" title="4 stars">4 stars</label>\n                                              <input type="radio" id="star3" name="rate" value="3">\n                                              <label onclick="TimesApp.sendReview(this.getAttribute(\'data-value\'))" for="star3" data-value="3" title="3 stars">3 stars</label>\n                                              <input type="radio" id="star2" name="rate" value="2">\n                                              <label onclick="TimesApp.sendReview(this.getAttribute(\'data-value\'))" for="star2" data-value="2" title="2 stars">2 stars</label>\n                                              <input type="radio" id="star1" name="rate" value="1">\n                                              <label onclick="TimesApp.sendReview(this.getAttribute(\'data-value\'))" for="star1" data-value="1" title="1 star">1 star</label>\n                                            </div>\n                                            ',-1)},1e5)}),window.addEventListener("appinstalled",function(){ga("send","event","PWA","Installed","true"),Utils.sendError({pwa_installed:!0})}),function(e,t,a,s,i,n,o){e.GoogleAnalyticsObject=i,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,n=t.createElement(a),o=t.getElementsByTagName(a)[0],n.async=1,n.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(n,o)}(window,document,"script",0,"ga"),ga("create","UA-10999521-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");try{navigator.serviceWorker.register("sw.js")}catch(e){console.log(e)}</script></body></html>